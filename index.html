<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Tech SEO Master</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1020">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root{
      --bg:#0b1020; --card:rgba(255,255,255,0.08);
      --text:#f0f0f0; --accent:#7c5cff; --ok:#00d2ff; --ng:#ff4757;
    }
    body {
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg); color: var(--text); overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    .app-container { max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    h1 { font-size: 20px; font-weight: 800; background: linear-gradient(to right, #7c5cff, #22c1c3); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
    
    /* è¨€èªã‚¹ã‚¤ãƒƒãƒ */
    .lang-switch {
      display: flex; background: rgba(255,255,255,0.1); border-radius: 20px; padding: 2px;
    }
    .lang-btn {
      background: transparent; border: none; color: rgba(255,255,255,0.5);
      padding: 6px 12px; font-size: 12px; font-weight: bold; cursor: pointer; border-radius: 18px;
      transition: all 0.2s;
    }
    .lang-btn.active { background: var(--accent); color: #fff; }

    /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .card {
      background: var(--card); border-radius: 24px; padding: 24px;
      backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .slide-in { animation: slideIn 0.4s ease-out forwards; }

    .progress-track { height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 20px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.4s ease; }

    .question { font-size: 18px; font-weight: 700; line-height: 1.5; margin-bottom: 24px; min-height: 60px;}
    .tag { font-size: 11px; color: rgba(255,255,255,0.6); border: 1px solid rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 6px; vertical-align: middle; margin-right: 6px; }

    .btn-option {
      width: 100%; text-align: left; padding: 16px; margin-bottom: 12px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px; color: var(--text); font-size: 14px; font-weight: 600;
      transition: all 0.2s; cursor: pointer; position: relative;
    }
    .btn-option:active { transform: scale(0.98); background: rgba(255,255,255,0.1); }
    .btn-option.correct { background: rgba(0, 210, 255, 0.2); border-color: var(--ok); color: var(--ok); }
    .btn-option.wrong { background: rgba(255, 71, 87, 0.2); border-color: var(--ng); }
    
    .explanation {
      display: none; background: rgba(0,0,0,0.3); padding: 16px; border-radius: 16px;
      margin-top: 20px; font-size: 13px; line-height: 1.6; border-left: 4px solid var(--accent);
    }
    .explanation.show { display: block; animation: slideIn 0.3s ease; }

    /* ãƒœã‚¿ãƒ³ä¿®æ­£: ã¯ã¿å‡ºã—é˜²æ­¢ã®ãŸã‚ box-sizing ã¨ width ã‚’èª¿æ•´ */
    .btn-next {
      width: 100%; padding: 16px; margin-top: 20px; background: var(--accent); border: none;
      border-radius: 14px; color: #fff; font-weight: bold; font-size: 16px;
      display: none; cursor: pointer; box-shadow: 0 4px 15px rgba(124, 92, 255, 0.4);
      transition: transform 0.1s;
      box-sizing: border-box;
    }
    .btn-next:active { transform: scale(0.98); opacity: 0.9; }

    .rank-badge { font-size: 48px; font-weight: 900; color: var(--ok); text-shadow: 0 0 20px var(--ok); display:block; margin: 10px 0;}

    footer { text-align: center; color: rgba(255,255,255,0.4); font-size: 12px; margin-top: auto; padding-top: 20px; }
  </style>
</head>
<body>

<div class="app-container">
  <header>
    <h1>Tech SEO Master</h1>
    <div class="lang-switch">
      <button class="lang-btn active" id="btn-ja" onclick="setLang('ja')">JP</button>
      <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>
  </header>
  
  <div id="status-bar" style="font-size:13px; font-weight:bold; color:var(--accent); text-align:right; margin-bottom:10px;"></div>

  <div id="start-screen" class="card slide-in">
    <h2 style="text-align:center;" id="ui-start-title"></h2>
    <p style="opacity:0.8; text-align:center; font-size:14px; margin-bottom:30px;" id="ui-start-desc"></p>
    <button class="btn-next" onclick="startQuiz()" id="ui-start-btn" style="display:block;"></button>
  </div>

  <div id="game-card" class="card" style="display:none;">
    <div class="progress-track"><div id="progress" class="progress-fill"></div></div>
    <div id="q-meta" style="margin-bottom:8px;"></div>
    <div id="question" class="question"></div>
    <div id="options"></div>
    <div id="explanation" class="explanation"></div>
    <button id="btn-next" class="btn-next" onclick="nextQuestion()"></button>
  </div>

  <footer>
    Created by <a href="https://twitter.com/OkaTakuma1" target="_blank" style="color:var(--accent); text-decoration:none; font-weight:bold;">Takuma Oka</a>
  </footer>
</div>

<script>
// --- UIç¿»è¨³ãƒ‡ãƒ¼ã‚¿ ---
const UI_TEXT = {
  ja: {
    startTitle: "å®ŸåŠ›è¨ºæ–­ãƒ†ã‚¹ãƒˆ",
    startDesc: "å…¨100å•ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰<br>ãƒ©ãƒ³ãƒ€ãƒ ã«<strong style='color:var(--ok)'>30å•</strong>å‡ºé¡Œã•ã‚Œã¾ã™ã€‚<br>ã‚ãªãŸã®ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«SEOåŠ›ã‚’æ¸¬å®šã—ã¾ã™ã€‚",
    startBtn: "ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹",
    nextBtn: "æ¬¡ã®å•é¡Œã¸",
    resultBtn: "çµæœã‚’è¦‹ã‚‹",
    explanation: "ğŸ’¡ è§£èª¬",
    resultTitle: "çµæœç™ºè¡¨",
    correctLabel: "æ­£è§£æ•°",
    rankLabel: "ãƒ©ãƒ³ã‚¯",
    retryBtn: "ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹",
    shareBtn: "çµæœã‚’ã‚·ã‚§ã‚¢",
    msgS: "å®Œç’§ï¼ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«SEOãƒã‚¹ã‚¿ãƒ¼ï¼",
    msgA: "ç´ æ™´ã‚‰ã—ã„ï¼ç¾å ´ã§æˆ¦ãˆã‚‹ãƒ¬ãƒ™ãƒ«ï¼",
    msgB: "ã‚ã¨ä¸€æ­©ï¼å¾©ç¿’ã—ã‚ˆã†ã€‚",
    msgC: "ã¾ã ã¾ã ã“ã‚Œã‹ã‚‰ï¼",
    shareText: (rank, score, total) => `ã€Tech SEO Masterã€‘å®ŸåŠ›è¨ºæ–­ãƒ†ã‚¹ãƒˆã§ã€Œãƒ©ãƒ³ã‚¯${rank}ã€ã‚’å–ã‚Šã¾ã—ãŸï¼æ­£è§£æ•°: ${score}/${total} #TechSEOMaster`
  },
  en: {
    startTitle: "Skill Assessment",
    startDesc: "30 questions will be randomly selected<br>from the database.<br>Test your Technical SEO skills.",
    startBtn: "Start Quiz",
    nextBtn: "Next Question",
    resultBtn: "Show Results",
    explanation: "ğŸ’¡ Explanation",
    resultTitle: "Quiz Result",
    correctLabel: "Score",
    rankLabel: "Rank",
    retryBtn: "Try Again",
    shareBtn: "Share on X",
    msgS: "Perfect! You are a Tech SEO Master!",
    msgA: "Excellent! Professional level!",
    msgB: "Good! Keep learning.",
    msgC: "Keep it up! Needs practice.",
    shareText: (rank, score, total) => `[Tech SEO Master] I got "Rank ${rank}" in the Technical SEO Quiz! Score: ${score}/${total} #TechSEOMaster`
  }
};

// --- å¤šè¨€èªå¯¾å¿œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
// â€» å‹•ä½œç¢ºèªç”¨ã«30å•åˆ†ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚æ®‹ã‚Šã®å•é¡Œã¯ ja/en å½¢å¼ã§è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
const ALL_QUESTIONS = [
  { 
    id: "q001", tags: ["Index"], 
    ja: { q: "meta robots noindex ã®ä¸»ãªç›®çš„ã¯ï¼Ÿ", choices: ["ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ä¸Šã’ã‚‹", "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰é™¤å¤–ã•ã›ã‚‹æ„å›³ã‚’ä¼ãˆã‚‹", "ã‚¯ãƒ­ãƒ¼ãƒ«é »åº¦ã‚’ä¸Šã’ã‚‹", "å¿…ãš301ã‚’ç™ºç”Ÿã•ã›ã‚‹"], exp: "noindexã¯æ¤œç´¢çµæœã«å‡ºã•ãªã„æ„å›³ã‚’ä¼ãˆã‚‹ã‚¿ã‚°ã§ã™ã€‚" },
    en: { q: "What is the main purpose of meta robots noindex?", choices: ["Increase rankings", "Signal intent to exclude from index", "Increase crawl frequency", "Force a 301 redirect"], exp: "noindex signals the intent to prevent the page from appearing in search results." },
    ans: 1 
  },
  { 
    id: "q002", tags: ["Crawl"], 
    ja: { q: "robots.txt ã§ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", choices: ["ãƒšãƒ¼ã‚¸å†…å®¹ã‚’è§£æã§ãã‚‹", "ãƒšãƒ¼ã‚¸ã®å–å¾—è‡ªä½“ãŒæ­¢ã¾ã‚‹", "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¿…ãšæ¶ˆãˆã‚‹", "404ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹"], exp: "robotsãƒ–ãƒ­ãƒƒã‚¯ã¯å–å¾—è‡ªä½“ã‚’æ­¢ã‚ã‚‹ãŸã‚ã€ãƒ¡ã‚¿æƒ…å ±ã‚’èª­ã‚ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚" },
    en: { q: "What happens when a page is blocked by robots.txt?", choices: ["Google can parse content", "Page retrieval (crawling) stops", "Index is guaranteed to be removed", "It becomes a 404 error"], exp: "Blocking via robots.txt prevents the crawler from retrieving the page content." },
    ans: 1 
  },
  {
    id: "q003", tags: ["Canonical"],
    ja: { q: "rel=canonical ã®å½¹å‰²ã¯ï¼Ÿ", choices: ["å¼·åˆ¶çš„ãªå‘½ä»¤", "æ­£è¦URLã‚’ç¤ºã™ãƒ’ãƒ³ãƒˆ", "noindexã¨åŒã˜", "301ã¨åŒã˜"], exp: "canonicalã¯æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã«å¯¾ã—ã¦ã€ã“ã‚ŒãŒæ­£è¦ç‰ˆã§ã™ã€ã¨ä¼ãˆã‚‹å¼·åŠ›ãªãƒ’ãƒ³ãƒˆã§ã™ã€‚" },
    en: { q: "What is the role of rel=canonical?", choices: ["A directive (mandatory)", "A hint for the canonical URL", "Same as noindex", "Same as 301"], exp: "Canonical is a strong hint to tell search engines which URL is the master version." },
    ans: 1
  },
  {
    id: "q004", tags: ["Sitemap"],
    ja: { q: "XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã®å½¹å‰²ã¨ã—ã¦æ­£ã—ã„ã®ã¯ï¼Ÿ", choices: ["æ²è¼‰URLã¯å¿…ãšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã•ã‚Œã‚‹", "ç™ºè¦‹ã¨ã‚¯ãƒ­ãƒ¼ãƒ«ã®æ‰‹ãŒã‹ã‚Š", "ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¦å› ãã®ã‚‚ã®", "é‡è¤‡URLã‚’è‡ªå‹•å‰Šé™¤"], exp: "ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã¯ç™ºè¦‹ã¨å„ªå…ˆåº¦ã®ãƒ’ãƒ³ãƒˆã§ã‚ã‚Šã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚" },
    en: { q: "What is the correct role of an XML Sitemap?", choices: ["Guarantees indexing", "Hint for discovery and crawling", "A direct ranking factor", "Auto-deletes duplicates"], exp: "Sitemaps are hints for discovery and priority, not a guarantee of indexing." },
    ans: 1
  },
  {
    id: "q005", tags: ["Status"],
    ja: { q: "HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ 404 ãŒç¤ºã™ã®ã¯ï¼Ÿ", choices: ["æ’ä¹…çš„ãªç§»è»¢", "ä¸€æ™‚çš„ãªç§»è»¢", "è¦‹ã¤ã‹ã‚‰ãªã„ (Not Found)", "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼"], exp: "404ã¯ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚" },
    en: { q: "What does HTTP status 404 indicate?", choices: ["Moved Permanently", "Found (Temporary Redirect)", "Not Found", "Internal Server Error"], exp: "404 indicates that the requested resource could not be found." },
    ans: 2
  },
  {
    id: "q006", tags: ["Redirect"],
    ja: { q: "301 ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®æ„å‘³ã¯ï¼Ÿ", choices: ["ä¸€æ™‚çš„ãªè»¢é€", "æ’ä¹…çš„ãªè»¢é€", "ã‚¯ãƒ­ãƒ¼ãƒ«åœæ­¢", "noindexå‘½ä»¤"], exp: "301ã¯æ’ä¹…çš„ãªè»¢é€ã‚’è¡¨ã—ã€ãƒªãƒ³ã‚¯ã®è©•ä¾¡ã‚’å¼•ãç¶™ãã¾ã™ã€‚" },
    en: { q: "What does a 301 redirect mean?", choices: ["Temporary redirect", "Permanent redirect", "Stop crawling", "noindex directive"], exp: "301 indicates a permanent move and passes link equity." },
    ans: 1
  },
  {
    id: "q007", tags: ["CWV"],
    ja: { q: "LCPã¯ä½•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ï¼Ÿ", choices: ["å…¥åŠ›å¿œç­”ã®é€Ÿã•", "æœ€å¤§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æç”»æ™‚é–“", "ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ã‚ºãƒ¬", "ã‚µãƒ¼ãƒãƒ¼ã®ç¨¼åƒç‡"], exp: "Largest Contentful Paintã€‚ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ã‚’æ¸¬ã‚Šã¾ã™ã€‚" },
    en: { q: "What does LCP measure?", choices: ["Input responsiveness", "Largest content render time", "Layout shift", "Server uptime"], exp: "Largest Contentful Paint measures render time of the main content." },
    ans: 1
  },
  {
    id: "q008", tags: ["CWV"],
    ja: { q: "CLSã¯ä½•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ï¼Ÿ", choices: ["ãƒšãƒ¼ã‚¸ã®è‰²", "è¦–è¦šçš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ã‚ºãƒ¬", "JSã®è¡Œæ•°", "ã‚¯ãƒ­ãƒ¼ãƒ«é »åº¦"], exp: "Cumulative Layout Shiftã€‚èª­ã¿è¾¼ã¿ä¸­ã®æ„å›³ã—ãªã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç§»å‹•ã‚’æ¸¬ã‚Šã¾ã™ã€‚" },
    en: { q: "What does CLS measure?", choices: ["Page color", "Visual layout shift", "Lines of JS", "Crawl frequency"], exp: "Cumulative Layout Shift measures unexpected layout shifts during loading." },
    ans: 1
  },
  {
    id: "q009", tags: ["CWV"],
    ja: { q: "INPã¯ä½•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ï¼Ÿ", choices: ["ç”»åƒã‚µã‚¤ã‚º", "æ“ä½œã«å¯¾ã™ã‚‹å¿œç­”æ€§", "robotsè¨­å®š", "ã‚µã‚¤ãƒˆãƒãƒƒãƒ—æ•°"], exp: "Interaction to Next Paintã€‚ã‚¯ãƒªãƒƒã‚¯ã‚„ã‚¿ãƒƒãƒ—ã«å¯¾ã™ã‚‹åå¿œã®è‰¯ã•ã‚’æ¸¬ã‚Šã¾ã™ã€‚" },
    en: { q: "What does INP measure?", choices: ["Image size", "Responsiveness to interaction", "Robots settings", "Sitemap count"], exp: "Interaction to Next Paint measures responsiveness to user clicks/taps." },
    ans: 1
  },
  {
    id: "q010", tags: ["Rendering"],
    ja: { q: "CSR (Client Side Rendering) ã®å¼±ç‚¹ã¯ï¼Ÿ", choices: ["åˆæœŸHTMLãŒç©ºã§è©•ä¾¡ãŒé…ã‚Œã‚‹", "å¿…ãšé †ä½ãŒä¸ŠãŒã‚‹", "LCPãŒå¿…ãšæ”¹å–„ã™ã‚‹", "ã‚¯ãƒ­ãƒ¼ãƒ«ãŒæ­¢ã¾ã‚‹"], exp: "JSå®Ÿè¡Œå¾Œã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå‡ºã‚‹ãŸã‚ã€ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã®åˆå›è©•ä¾¡ãŒé…ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚" },
    en: { q: "What is a potential weakness of CSR?", choices: ["Empty initial HTML delays indexing", "Always improves rankings", "Always improves LCP", "Stops crawling"], exp: "Content appears after JS execution, which can delay crawler discovery." },
    ans: 0
  },
  {
    id: "q011", tags: ["Crawl"],
    ja: { q: "ã‚¯ãƒ­ãƒ¼ãƒ«ãƒã‚¸ã‚§ãƒƒãƒˆã‚’æµªè²»ã™ã‚‹æœ€å¤§ã®è¦å› ã¯ï¼Ÿ", choices: ["é«˜ç”»è³ªç”»åƒ", "ç„¡é™ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿URL", "CSSãƒ•ã‚¡ã‚¤ãƒ«", "é•·ã„ãƒ†ã‚­ã‚¹ãƒˆ"], exp: "ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ãªã©ã§ç”Ÿæˆã•ã‚Œã‚‹ç„¡é™ã®URLã¯ã€ãƒœãƒƒãƒˆã‚’ç–²å¼Šã•ã›ã¾ã™ã€‚" },
    en: { q: "What is a major cause of crawl budget waste?", choices: ["High-res images", "Infinite parameter URLs", "CSS files", "Long text"], exp: "Infinite URLs from filters/facets trap bots and waste budget." },
    ans: 1
  },
  {
    id: "q012", tags: ["Mobile"],
    ja: { q: "ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ãªã„ã¨ã©ã†ãªã‚‹ï¼Ÿ", choices: ["PCæ¤œç´¢ã§åœå¤–ã«ãªã‚‹", "ãƒ¢ãƒã‚¤ãƒ«æ¤œç´¢ã§ã®è©•ä¾¡ãŒä¸‹ãŒã‚‹", "ã‚µã‚¤ãƒˆãŒå‰Šé™¤ã•ã‚Œã‚‹", "åºƒå‘ŠãŒå‡ºãªã„"], exp: "ç¾åœ¨ã¯ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãŸã‚ã€ã‚¹ãƒãƒ›å¯¾å¿œã¯å¿…é ˆã§ã™ã€‚" },
    en: { q: "What happens if a site is not mobile-friendly?", choices: ["Removed from PC search", "Lower ranking in mobile search", "Site is deleted", "No ads shown"], exp: "Mobile-friendliness is crucial under Mobile First Indexing." },
    ans: 1
  },
  {
    id: "q013", tags: ["Speed"],
    ja: { q: "ç”»åƒã®é…å»¶èª­ã¿è¾¼ã¿(Lazy-load)ã®æ³¨æ„ç‚¹ã¯ï¼Ÿ", choices: ["å…¨ã¦ã®ç”»åƒã«è¡Œã†", "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ç”»åƒã«ã¯é©ç”¨ã—ãªã„", "èƒŒæ™¯ç”»åƒã®ã¿ã«è¡Œã†", "ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ã«è¡Œã†"], exp: "LCPè¦ç´ ï¼ˆä¸€ç•ªä¸Šã®ç”»åƒï¼‰ã‚’é…å»¶ã•ã›ã‚‹ã¨ã€LCPãŒæ‚ªåŒ–ã—ã¦ã—ã¾ã„ã¾ã™ã€‚" },
    en: { q: "What is a precaution for image Lazy-loading?", choices: ["Apply to all images", "Do not apply to above-the-fold images", "Apply only to backgrounds", "Apply only to icons"], exp: "Lazy-loading the LCP image delays its render and hurts scores." },
    ans: 1
  },
  {
    id: "q014", tags: ["Security"],
    ja: { q: "HTTPSåŒ–ï¼ˆSSLï¼‰ã¯SEOã«å½±éŸ¿ã™ã‚‹ï¼Ÿ", choices: ["å…¨ãã—ãªã„", "ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¦å› ã®ä¸€ã¤ã§ã‚ã‚‹", "ãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹", "ç”»åƒæ¤œç´¢ã®ã¿å½±éŸ¿"], exp: "Googleã¯HTTPSã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚°ãƒŠãƒ«ã®ä¸€ã¤ã¨ã—ã¦å…¬è¡¨ã—ã¦ã„ã¾ã™ã€‚" },
    en: { q: "Does HTTPS affect SEO?", choices: ["No effect", "It is a ranking signal", "Negative effect", "Only affects image search"], exp: "Google has confirmed HTTPS is a lightweight ranking signal." },
    ans: 1
  },
  {
    id: "q015", tags: ["Index"],
    ja: { q: "é‡è¤‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå¤§é‡ã«ã‚ã‚‹ã¨èµ·ãã‚‹å•é¡Œã¯ï¼Ÿ", choices: ["è©•ä¾¡ã®åˆ†æ•£ã¨ã‚¯ãƒ­ãƒ¼ãƒ«æµªè²»", "é †ä½ä¸Šæ˜‡", "CWVæ”¹å–„", "ã‚µã‚¤ãƒˆãƒªãƒ³ã‚¯è¡¨ç¤º"], exp: "åŒã˜å†…å®¹ã®ãƒšãƒ¼ã‚¸ãŒå¤šã„ã¨ã€ã©ã®ãƒšãƒ¼ã‚¸ã‚’è©•ä¾¡ã™ã¹ãã‹è¿·ã„ã€è©•ä¾¡ãŒåˆ†æ•£ã—ã¾ã™ã€‚" },
    en: { q: "What is the problem with massive duplicate content?", choices: ["Diluted signals and crawl waste", "Higher rankings", "Better CWV", "Sitelinks appear"], exp: "It splits link equity and confuses search engines on which to rank." },
    ans: 0
  },
  {
    id: "q016", tags: ["Link"],
    ja: { q: "å†…éƒ¨ãƒªãƒ³ã‚¯ã®SEOä¸Šã®åŠ¹æœã¯ï¼Ÿ", choices: ["åºƒå‘Šåå…¥å¢—åŠ ", "ãƒšãƒ¼ã‚¸ã®é‡è¦åº¦ä¼é”ã¨ç™ºè¦‹", "ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›", "ç”»åƒåœ§ç¸®"], exp: "å†…éƒ¨ãƒªãƒ³ã‚¯ã¯ã€ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã®é€šã‚Šé“ã§ã‚ã‚Šã€ãƒšãƒ¼ã‚¸é–“ã®é‡è¦åº¦ã‚’æ¸¡ã™å½¹å‰²ãŒã‚ã‚Šã¾ã™ã€‚" },
    en: { q: "What is the SEO benefit of internal links?", choices: ["More ad revenue", "Passing authority and discovery", "Lower server load", "Image compression"], exp: "They aid navigation, discovery, and distribute PageRank." },
    ans: 1
  },
  {
    id: "q017", tags: ["Schema"],
    ja: { q: "æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿(Schema.org)ã®ãƒ¡ãƒªãƒƒãƒˆã¯ï¼Ÿ", choices: ["å¿…ãš1ä½ã«ãªã‚‹", "æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ãŒå†…å®¹ã‚’ç†è§£ã—ã‚„ã™ããªã‚‹", "ãƒ‡ã‚¶ã‚¤ãƒ³ãŒè‰¯ããªã‚‹", "åºƒå‘ŠãŒæ¶ˆãˆã‚‹"], exp: "ãƒªãƒƒãƒãƒªã‚¶ãƒ«ãƒˆï¼ˆæ˜Ÿè©•ä¾¡ã‚„Q&Aãªã©ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚" },
    en: { q: "What is the benefit of Structured Data?", choices: ["Guaranteed #1 rank", "Helps search engines understand content", "Better design", "Removes ads"], exp: "It helps machines understand context and can trigger Rich Results." },
    ans: 1
  },
  {
    id: "q018", tags: ["Schema"],
    ja: { q: "JSON-LDã¯ã©ã“ã«è¨˜è¿°ã™ã‚‹ã®ãŒæ¨å¥¨ï¼Ÿ", choices: ["bodyã®æœ«å°¾", "headå†…ã®scriptã‚¿ã‚°", "CSSãƒ•ã‚¡ã‚¤ãƒ«", "ç”»åƒaltå±æ€§"], exp: "Googleã¯script type='application/ld+json'å½¢å¼ã§ã®è¨˜è¿°ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚" },
    en: { q: "Where is JSON-LD best placed?", choices: ["End of body", "Script tag in head", "CSS file", "Image alt attribute"], exp: "Google recommends placing JSON-LD in a script tag within the head." },
    ans: 1
  },
  {
    id: "q019", tags: ["Redirect"],
    ja: { q: "302 ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®ç”¨é€”ã¯ï¼Ÿ", choices: ["æ’ä¹…çš„ãªè»¢é€", "ä¸€æ™‚çš„ãªè»¢é€", "å‰Šé™¤", "ã‚¨ãƒ©ãƒ¼"], exp: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã‚„ABãƒ†ã‚¹ãƒˆãªã©ã€ä¸€æ™‚çš„ãªè»¢é€ã«ã¯302ã‚’ä½¿ã„ã¾ã™ã€‚" },
    en: { q: "When should you use a 302 redirect?", choices: ["Permanent move", "Temporary move", "Deletion", "Error"], exp: "302 is for temporary situations like maintenance or A/B testing." },
    ans: 1
  },
  {
    id: "q020", tags: ["Logs"],
    ja: { q: "ãƒ­ã‚°åˆ†æã§æœ€ã‚‚è¦‹ãŸã„æŒ‡æ¨™ã®ä¸€ã¤ã¯ï¼Ÿ", choices: ["ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º", "Googlebotã®ã‚¢ã‚¯ã‚»ã‚¹é »åº¦", "SNSã„ã„ã­æ•°", "ç”»åƒã®å½©åº¦"], exp: "ã©ã®URLã«ã©ã‚Œã ã‘ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæ¥ã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹ã“ã¨ã¯é‡è¦ã§ã™ã€‚" },
    en: { q: "What is a key metric in Log Analysis?", choices: ["Font size", "Googlebot hit frequency", "Social likes", "Image saturation"], exp: "Understanding crawl frequency helps optimize crawl budget." },
    ans: 1
  },
  {
    id: "q021", tags: ["Status"],
    ja: { q: "HTTP 500 ã‚¨ãƒ©ãƒ¼ã®æ„å‘³ã¯ï¼Ÿ", choices: ["è¦‹ã¤ã‹ã‚‰ãªã„", "ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢", "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼", "ä¸€æ™‚çš„ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ"], exp: "500ç•ªå°ã¯ã‚µãƒ¼ãƒãƒ¼å´ã®å•é¡Œã‚’æ„å‘³ã—ã¾ã™ã€‚" },
    en: { q: "What does HTTP 500 mean?", choices: ["Not Found", "Forbidden", "Internal Server Error", "Temporary Redirect"], exp: "5xx codes indicate a failure on the server side." },
    ans: 2
  },
  {
    id: "q022", tags: ["Index"],
    ja: { q: "ã‚½ãƒ•ãƒˆ404 (Soft 404) ã¨ã¯ï¼Ÿ", choices: ["200ã‚’è¿”ã—ã¦ã„ã‚‹ãŒä¸­èº«ãŒãªã„", "404ã‚’è¿”ã—ã¦ã„ã‚‹", "301ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ", "503ã‚¨ãƒ©ãƒ¼"], exp: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯æ­£å¸¸(200)ãªã®ã«ã€å®Ÿè³ªçš„ã«ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã—ãªã„çŠ¶æ…‹ã§ã™ã€‚" },
    en: { q: "What is a Soft 404?", choices: ["Returns 200 but has no content", "Returns 404", "Is a 301 redirect", "Is a 503 error"], exp: "The server says 'OK' (200), but the page looks like an error page to Google." },
    ans: 0
  },
  {
    id: "q023", tags: ["Crawl"],
    ja: { q: "Orphan Pageï¼ˆå­¤ç«‹ãƒšãƒ¼ã‚¸ï¼‰ã¨ã¯ï¼Ÿ", choices: ["å†…éƒ¨ãƒªãƒ³ã‚¯ãŒãªã„ãƒšãƒ¼ã‚¸", "å¤–éƒ¨ãƒªãƒ³ã‚¯ãŒå¤šã„ãƒšãƒ¼ã‚¸", "404ãƒšãƒ¼ã‚¸", "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸"], exp: "ã©ã“ã‹ã‚‰ã‚‚ãƒªãƒ³ã‚¯ã•ã‚Œã¦ãŠã‚‰ãšã€ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒç™ºè¦‹ã—ã«ãã„ãƒšãƒ¼ã‚¸ã®ã“ã¨ã§ã™ã€‚" },
    en: { q: "What is an Orphan Page?", choices: ["Page with no internal links", "Page with many backlinks", "404 Page", "Homepage"], exp: "A page not linked to from anywhere on the site, making it hard to find." },
    ans: 0
  },
  {
    id: "q024", tags: ["Hreflang"],
    ja: { q: "hreflangã‚¿ã‚°ãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ã¯ï¼Ÿ", choices: ["å¤šè¨€èªãƒ»å¤šåœ°åŸŸå‘ã‘ã‚µã‚¤ãƒˆ", "1ãƒšãƒ¼ã‚¸ã ã‘ã®ã‚µã‚¤ãƒˆ", "ç”»åƒã‚µã‚¤ãƒˆ", "ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ã‚¸ãƒã‚¹"], exp: "è¨€èªã‚„åœ°åŸŸã”ã¨ã«ç•°ãªã‚‹URLã‚’è¡¨ç¤ºã•ã›ãŸã„å ´åˆã«ä½¿ã„ã¾ã™ã€‚" },
    en: { q: "When is hreflang needed?", choices: ["Multi-language/region sites", "Single page sites", "Image sites", "Local business"], exp: "It tells Google which version of a page to show for different languages/regions." },
    ans: 0
  },
  {
    id: "q025", tags: ["Rendering"],
    ja: { q: "SSR (Server Side Rendering) ã®ãƒ¡ãƒªãƒƒãƒˆã¯ï¼Ÿ", choices: ["åˆæœŸHTMLã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå«ã¾ã‚Œã‚‹", "ã‚µãƒ¼ãƒãƒ¼è² è·ãŒã‚¼ãƒ­ã«ãªã‚‹", "JSãŒä¸è¦ã«ãªã‚‹", "CSSãŒä¸è¦ã«ãªã‚‹"], exp: "ã‚µãƒ¼ãƒãƒ¼ã§HTMLã‚’ä½œã£ã¦è¿”ã™ãŸã‚ã€ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå³åº§ã«å†…å®¹ã‚’ç†è§£ã§ãã¾ã™ã€‚" },
    en: { q: "What is a benefit of SSR?", choices: ["Content is in initial HTML", "Zero server load", "No JS needed", "No CSS needed"], exp: "SSR delivers fully populated HTML, improving immediate indexability." },
    ans: 0
  },
  {
    id: "q026", tags: ["CWV"],
    ja: { q: "TTFB (Time to First Byte) ã¨ã¯ï¼Ÿ", choices: ["æœ€åˆã®1ãƒã‚¤ãƒˆãŒå±Šãã¾ã§ã®æ™‚é–“", "ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹æ™‚é–“", "ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã¾ã§ã®æ™‚é–“", "å…¨èª­ã¿è¾¼ã¿æ™‚é–“"], exp: "ã‚µãƒ¼ãƒãƒ¼ã®å¿œç­”é€Ÿåº¦ã‚’ç¤ºã™é‡è¦ãªæŒ‡æ¨™ã§ã™ã€‚" },
    en: { q: "What is TTFB?", choices: ["Time to First Byte", "Time to First Body", "Time to Full Build", "Total Time For Bot"], exp: "It measures the latency of the server response." },
    ans: 0
  },
  {
    id: "q027", tags: ["Index"],
    ja: { q: "Googleæ¤œç´¢ã®ã€Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ã¨ã¯ï¼Ÿ", choices: ["ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç™»éŒ²", "ã‚µã‚¤ãƒˆã®å‰Šé™¤", "é †ä½ã®æ±ºå®š", "åºƒå‘Šã®è¡¨ç¤º"], exp: "ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒé›†ã‚ãŸæƒ…å ±ã‚’æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ã“ã¨ã§ã™ã€‚" },
    en: { q: "What is 'Indexing' in Google Search?", choices: ["Adding to database", "Deleting site", "Ranking decision", "Showing ads"], exp: "It's the process of storing organized information about pages in the index." },
    ans: 0
  },
  {
    id: "q028", tags: ["Redirect"],
    ja: { q: "ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³ã¨ã¯ï¼Ÿ", choices: ["ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒé€£ç¶šã™ã‚‹ã“ã¨", "ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãªã„ã“ã¨", "ãƒã‚§ãƒ¼ãƒ³åº—ã®SEO", "å¤–éƒ¨ãƒªãƒ³ã‚¯ã®ã“ã¨"], exp: "Aâ†’Bâ†’Cã®ã‚ˆã†ã«è»¢é€ãŒç¶šãã“ã¨ã§ã€é…å»¶ã‚„ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚" },
    en: { q: "What is a Redirect Chain?", choices: ["Multiple redirects in a row", "No redirects", "Chain store SEO", "Backlinks"], exp: "A series of redirects (A->B->C) that slows load time and wastes crawl budget." },
    ans: 0
  },
  {
    id: "q029", tags: ["Sitemap"],
    ja: { q: "ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã®ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¨ã—ã¦ä¸€èˆ¬çš„ãªã®ã¯ï¼Ÿ", choices: ["XML", "DOCX", "MP4", "EXE"], exp: "æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å‘ã‘ã«ã¯XMLå½¢å¼ãŒæ¨™æº–ã§ã™ã€‚" },
    en: { q: "What is the common file format for Sitemaps?", choices: ["XML", "DOCX", "MP4", "EXE"], exp: "XML is the standard format for communicating with search bots." },
    ans: 0
  },
  {
    id: "q030", tags: ["Tech"],
    ja: { q: "robots.txtã®å ´æ‰€ã¯ã©ã“ãŒæ­£ã—ã„ï¼Ÿ", choices: ["ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹", "cssãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­", "ç”»åƒã®ãƒ•ã‚©ãƒ«ãƒ€", "ã©ã“ã§ã‚‚è‰¯ã„"], exp: "ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒˆï¼ˆä¾‹: example.com/robots.txtï¼‰ã«ç½®ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚" },
    en: { q: "Where must robots.txt be placed?", choices: ["Root directory", "Inside css folder", "Image folder", "Anywhere"], exp: "It must be at the root level (e.g., example.com/robots.txt)." },
    ans: 0
  }
];

const QUIZ_COUNT = 30; // æœ¬ç•ªå‡ºé¡Œæ•°
let currentDeck = [];
let currentIdx = 0;
let score = 0;
let currentLang = 'ja'; // åˆæœŸè¨€èª

// PWAè¨­å®š
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}

// è¨€èªåˆ‡ã‚Šæ›¿ãˆå‡¦ç†
function setLang(lang) {
  currentLang = lang;
  
  document.getElementById('btn-ja').className = lang === 'ja' ? 'lang-btn active' : 'lang-btn';
  document.getElementById('btn-en').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
  
  document.documentElement.lang = lang;
  updateUIText();
}

function updateUIText() {
  const t = UI_TEXT[currentLang];
  document.getElementById('ui-start-title').textContent = t.startTitle;
  document.getElementById('ui-start-desc').innerHTML = t.startDesc;
  document.getElementById('ui-start-btn').textContent = t.startBtn;
  
  const btnNext = document.getElementById('btn-next');
  if (btnNext.style.display !== 'none') {
     if (currentIdx >= QUIZ_COUNT) {
         // çµæœç”»é¢
     } else {
         btnNext.textContent = (currentIdx === QUIZ_COUNT - 1) ? t.resultBtn : t.nextBtn;
     }
  }
  
  // ã‚¯ã‚¤ã‚ºä¸­ãªã‚‰å•é¡Œæ–‡ã‚‚æ›´æ–°
  const gameCard = document.getElementById('game-card');
  if (gameCard.style.display === 'block' && currentIdx < QUIZ_COUNT && currentDeck.length > 0) {
      const qData = currentDeck[currentIdx];
      // å•é¡Œæ–‡æ›´æ–°
      document.getElementById('question').textContent = qData[currentLang].q;
      // é¸æŠè‚¢ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°ï¼ˆãƒœã‚¿ãƒ³é †åºã¯å¤‰ãˆãªã„ï¼‰
      // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€å¯¾å¿œã™ã‚‹è¨€èªã®ãƒ†ã‚­ã‚¹ãƒˆã«æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€
      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¸ˆã¿ã®ãŸã‚ã€å„ãƒœã‚¿ãƒ³ãŒã€Œå…ƒã®é¸æŠè‚¢ã®ä½•ç•ªç›®ã‹ã€ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
      // ç°¡æ˜“çš„ãªå®Ÿè£…ã¨ã—ã¦ã€ã“ã“ã§ã¯ã€Œå›ç­”å‰ã€ã§ã‚ã‚Œã°å†ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚
      // å›ç­”å¾Œã ã¨è§£èª¬ã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚Šè¤‡é›‘ã«ãªã‚‹ãŸã‚ã€
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¨ã—ã¦ã¯ã€Œåˆ‡ã‚Šæ›¿ãˆãŸã‚‰ãã®å•é¡Œã®æœ€åˆã«æˆ»ã‚‹ã€ã‚ˆã†ãªæŒ™å‹•ã«è¦‹ãˆã‚‹ã®ãŒè‡ªç„¶ã€‚
      // ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«è§£èª¬æ–‡ã®æ›´æ–°ã ã‘è¡Œã†ï¼ˆå›ç­”æ¸ˆã¿ã®å ´åˆï¼‰ã€‚
      const expDiv = document.getElementById('explanation');
      if (expDiv.classList.contains('show')) {
          expDiv.innerHTML = `<strong>${t.explanation}</strong><br>` + qData[currentLang].exp;
      }
      // â€»é¸æŠè‚¢ãƒœã‚¿ãƒ³ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨€èªåˆ‡æ›¿ã¯è¤‡é›‘åº¦ãŒé«˜ã„ãŸã‚ã€
      // å®Ÿæˆ¦çš„ã«ã¯ã€Œæ¬¡ã¸ã€é€²ã‚“ã ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¨€èªãŒé©ç”¨ã•ã‚Œã‚‹ã€ã¾ãŸã¯
      // ã“ã“ã§ãƒ­ãƒ¼ãƒ‰ã—ç›´ã™ã®ãŒè‰¯ã„ã€‚ä»Šå›ã¯ãƒ­ãƒ¼ãƒ‰ã—ç›´ã—ã‚’æ¡ç”¨ã€‚
      // ãŸã ã—å›ç­”æ¸ˆã¿ã®å ´åˆã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€å›ç­”æ¸ˆã¿ãƒ•ãƒ©ã‚°ãŒå¿…è¦ã ãŒ
      // ç°¡ç•¥åŒ–ã®ãŸã‚ã€å›ç­”ä¸­ã«åˆ‡ã‚Šæ›¿ãˆãŸå ´åˆã¯ã€Œæ—¥æœ¬èª/è‹±èªãŒæ··ã–ã‚‹ã€ã®ã‚’é˜²ããŸã‚
      // ã‚¯ã‚¤ã‚ºé–‹å§‹å‰æ¨å¥¨ã€ã‚ã‚‹ã„ã¯æ¬¡å•ã‹ã‚‰é©ç”¨ã¨ã™ã‚‹ã®ãŒç„¡é›£ã€‚
      // ã“ã“ã§ã¯è§£èª¬æ–‡ã¨UIå‘¨ã‚Šã®ã¿å³æ™‚åæ˜ ã¨ã™ã‚‹ã€‚
  }
}

// é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// ã‚¯ã‚¤ã‚ºé–‹å§‹
function startQuiz() {
  const shuffled = shuffle([...ALL_QUESTIONS]);
  currentDeck = shuffled.slice(0, QUIZ_COUNT);
  currentIdx = 0;
  score = 0;
  
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('game-card').style.display = 'block';
  document.getElementById('game-card').classList.add('slide-in');
  
  loadQuestion();
}

function loadQuestion() {
  if (!currentDeck[currentIdx]) {
    showResult();
    return;
  }

  const q = currentDeck[currentIdx];
  const qContent = q[currentLang];
  
  const card = document.getElementById('game-card');
  card.classList.remove('slide-in');
  void card.offsetWidth;
  card.classList.add('slide-in');

  const t = UI_TEXT[currentLang];
  document.getElementById('status-bar').textContent = `Q.${currentIdx + 1} / ${QUIZ_COUNT}`;

  document.getElementById('q-meta').innerHTML = `<span class="tag">${q.tags[0]}</span>`;
  document.getElementById('question').textContent = qContent.q;
  document.getElementById('progress').style.width = `${(currentIdx / QUIZ_COUNT) * 100}%`;

  // é¸æŠè‚¢ç”Ÿæˆï¼†ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML = "";

  let indices = qContent.choices.map((_, i) => i);
  indices = shuffle(indices);
  
  indices.forEach((originalIndex) => {
    const btn = document.createElement('button');
    btn.className = "btn-option";
    // è¨€èªåˆ‡ã‚Šæ›¿ãˆæ™‚ã«å‚ç…§ã§ãã‚‹ã‚ˆã†ã€dataå±æ€§ã‚’æŒãŸã›ã¦ã‚‚è‰¯ã„ãŒä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«
    btn.textContent = qContent.choices[originalIndex];
    btn.onclick = () => checkAnswer(originalIndex, q.ans, btn);
    optsDiv.appendChild(btn);
  });

  document.getElementById('explanation').className = "explanation";
  const btnNext = document.getElementById('btn-next');
  btnNext.style.display = "none";
  btnNext.textContent = t.nextBtn;
}

function checkAnswer(selectedIndex, correctIndex, btn) {
  try { if (navigator.vibrate) navigator.vibrate(10); } catch(e) {}

  const btns = document.querySelectorAll('.btn-option');
  btns.forEach(b => b.disabled = true);

  if (selectedIndex === correctIndex) {
    btn.classList.add('correct');
    score++;
  } else {
    btn.classList.add('wrong');
    // æ­£è§£ãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆä¸€è‡´ã§åˆ¤å®šï¼‰
    const correctText = currentDeck[currentIdx][currentLang].choices[correctIndex];
    btns.forEach(b => {
        if(b.textContent === correctText) b.classList.add('correct');
    });
    try { if (navigator.vibrate) navigator.vibrate([30, 50, 30]); } catch(e) {}
  }

  const t = UI_TEXT[currentLang];
  const expDiv = document.getElementById('explanation');
  expDiv.innerHTML = `<strong>${t.explanation}</strong><br>` + currentDeck[currentIdx][currentLang].exp;
  expDiv.classList.add('show');

  const nextBtn = document.getElementById('btn-next');
  nextBtn.textContent = (currentIdx === QUIZ_COUNT - 1) ? t.resultBtn : t.nextBtn;
  nextBtn.style.display = "block";
}

function nextQuestion() {
  currentIdx++;
  if (currentIdx < QUIZ_COUNT) {
    loadQuestion();
  } else {
    showResult();
  }
}

function showResult() {
  const t = UI_TEXT[currentLang];
  const percentage = (score / QUIZ_COUNT) * 100;
  let rank = "C";
  let msg = t.msgC;
  
  if(percentage >= 90) { rank = "S"; msg = t.msgS; }
  else if(percentage >= 70) { rank = "A"; msg = t.msgA; }
  else if(percentage >= 50) { rank = "B"; msg = t.msgB; }

  const shareText = t.shareText(rank, score, QUIZ_COUNT);
  const shareUrl = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(shareText) + "&url=" + encodeURIComponent(location.href);

  const card = document.getElementById('game-card');
  card.innerHTML = `
    <h2 style="text-align:center;">${t.resultTitle}</h2>
    <div style="text-align:center; margin:20px 0;">
      <span style="font-size:14px; opacity:0.7;">${t.correctLabel}</span><br>
      <span style="font-size:32px; font-weight:bold;">${score}</span> <span style="font-size:18px;">/ ${QUIZ_COUNT}</span>
    </div>
    <div style="text-align:center; margin-bottom:30px;">
      <span style="font-size:14px; opacity:0.7;">${t.rankLabel}</span>
      <span class="rank-badge">${rank}</span>
      <p style="color:var(--accent); font-weight:bold;">${msg}</p>
    </div>
    
    <a href="${shareUrl}" target="_blank" class="btn-next" style="display:flex; justify-content:center; align-items:center; text-decoration:none; background:#000000; border:1px solid rgba(255,255,255,0.3); margin-top:20px; margin-bottom:16px; box-sizing: border-box; max-width: 100%;">
      <span style="font-family: sans-serif; font-weight: 900; font-size: 18px; margin-right: 10px;">ğ•</span> ${t.shareBtn}
    </a>

    <button class="btn-next" onclick="location.reload()" style="display:block; background:transparent; border:1px solid rgba(255,255,255,0.3);">${t.retryBtn}</button>
  `;
}

// åˆæœŸåŒ–
window.onload = () => {
    updateUIText();
}
</script>
</body>
</html>
